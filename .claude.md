# YachtLife - Project Context

## Project Overview

YachtLife is a comprehensive yacht syndicate management platform with three main components:
1. **iOS App** (Swift/SwiftUI) - Native iOS app for yacht owners
2. **Web Dashboard** (React + TypeScript) - Management dashboard for administrators
3. **Backend API** (Go/Gin) - RESTful API serving both frontends

## Current Project Structure

```
YachtLife/
â”œâ”€â”€ backend/              âœ… Go/Gin API with PostgreSQL
â”œâ”€â”€ iOS/                  âœ… Native Swift/SwiftUI iOS app
â”œâ”€â”€ web/                  ðŸš§ React web dashboard (planned)
â”œâ”€â”€ mobile/               âš ï¸  DEPRECATED React Native (replaced by iOS/)
â””â”€â”€ docker-compose.yml    âœ… PostgreSQL + MinIO
```

## Tech Stack

### iOS App (NEW - Recommended)
- **Language**: Swift 5.9+
- **Framework**: SwiftUI
- **Architecture**: MVVM
- **Networking**: URLSession with async/await
- **Min iOS**: 17.0+
- **Location**: `/iOS/`
- **Status**: âœ… **WORKING** - Builds and runs successfully!

### Backend
- **Language**: Go 1.21+
- **Framework**: Gin
- **ORM**: GORM
- **Database**: PostgreSQL 15
- **Storage**: MinIO (S3-compatible)
- **Auth**: JWT tokens
- **Location**: `/backend/`
- **Status**: âœ… Fully functional

### Web Dashboard
- **Framework**: React 18+ TypeScript
- **Build Tool**: Vite
- **State**: Zustand
- **UI**: Material-UI or Ant Design
- **Location**: `/web/`
- **Status**: ðŸš§ To be implemented

## Database Schema

13 core tables:
1. **users** - User accounts (admin, manager, owner roles)
2. **yachts** - Vessel information
3. **syndicate_shares** - Ownership allocation
4. **bookings** - Booking management
5. **booking_change_requests** - Owner-initiated changes
6. **invoices** - Xero-synced invoices
7. **payments** - Stripe payments
8. **logbook_entries** - Fuel, maintenance logs
9. **checklists** - Pre-departure/return checklists
10. **votes** - Governance voting
11. **vote_responses** - Vote submissions
12. **maintenance_requests** - Issue reporting with photos
13. **notifications** - Multi-channel notifications

## API Structure

Base URL: `http://localhost:8080/api/v1`

### Key Endpoints
- `POST /auth/login` - Email/password authentication
- `GET /auth/me` - Get current user
- `GET /yachts` - List yachts
- `GET /bookings` - List bookings
- `POST /bookings` - Create booking
- `GET /invoices` - List invoices
- `GET /maintenance` - List maintenance requests
- `POST /maintenance` - Create maintenance request

## iOS App Structure

```
iOS/YachtLife/
â”œâ”€â”€ Models/              # Codable data models
â”‚   â”œâ”€â”€ User.swift
â”‚   â”œâ”€â”€ Yacht.swift
â”‚   â”œâ”€â”€ Booking.swift
â”‚   â”œâ”€â”€ Invoice.swift
â”‚   â””â”€â”€ Maintenance.swift
â”œâ”€â”€ Views/               # SwiftUI views
â”‚   â”œâ”€â”€ Auth/           # Login screens
â”‚   â”œâ”€â”€ Dashboard/      # Vessel dashboard
â”‚   â”œâ”€â”€ Bookings/       # Booking management
â”‚   â”œâ”€â”€ Invoices/       # Invoice viewing
â”‚   â”œâ”€â”€ Maintenance/    # Maintenance requests
â”‚   â””â”€â”€ Settings/       # User settings
â”œâ”€â”€ ViewModels/          # Business logic
â”‚   â””â”€â”€ AuthenticationViewModel.swift
â””â”€â”€ Services/            # API integration
    â””â”€â”€ APIService.swift
```

## Development Workflow

### Current Working Pattern

**Backend**:
```bash
cd backend
docker-compose up -d              # Start PostgreSQL + MinIO
go run ./cmd/server/main.go       # Start API server
```
Backend available at: `http://localhost:8080`

**iOS App**:
```bash
cd iOS
open YachtLife.xcodeproj          # Open in Xcode
# Select iPhone simulator
# Press Cmd+R to build and run
```

**Important**: Always start the backend before running the iOS app, as the app connects to `http://localhost:8080/api/v1`

### Running the iOS App
1. Open Xcode
2. File > New > Project
3. Select "iOS App"
4. Name: YachtLife
5. Interface: SwiftUI
6. Language: Swift
7. Save to: `/Users/lucascullen/Github/bitcoinbrisbane/YachtLife/iOS`
8. Add existing source files to project
9. Build and run (Cmd+R)

### Key Features Implemented

#### Backend âœ… WORKING
- JWT authentication with login endpoint
- User management (admin/manager/owner roles)
- Complete database schema with migrations (13 tables)
- Health check endpoint
- CORS middleware
- Request logging
- Running on http://localhost:8080

#### iOS App âœ… WORKING
- Login screen with email/password
- Dashboard with yacht cards and upcoming bookings
- Bookings list, detail, and creation views
- Invoices list with payment status
- Maintenance request list and creation
- Settings screen with logout
- Complete API integration layer (APIService.swift)
- Authentication state management (AuthenticationViewModel)
- Tab-based navigation
- **Status**: Compiles and runs in iOS Simulator without errors!

## Important Notes

### React Native Mobile Folder (DEPRECATED)
The `/mobile/` folder contains a React Native implementation that had persistent crashes and configuration issues. **Do not use this folder**. All mobile development should use the native iOS app in `/iOS/`.

### Authentication
- **iOS App**: Email/password login (Apple Sign In planned)
- **Web Dashboard**: Email/password login
- Both use JWT tokens stored securely

### Xero Integration (Planned)
- Invoices created in Xero
- Cached in PostgreSQL for fast app access
- Payments recorded via Stripe, then synced to Xero
- Webhooks for real-time status updates

### Payment Processing (Planned)
- Stripe integration for invoice payments
- Apple Pay support in iOS app
- Payment confirmation flow
- Automatic Xero reconciliation

## Next Steps

### Immediate Priority
1. **Web Dashboard** - Build React/TypeScript web dashboard for managers
   - Authentication (email/password login)
   - Fleet management
   - Master calendar for all bookings
   - Invoice creation
   - Analytics and reporting

### Short-term
2. **Complete iOS Features**
   - Voting system
   - Logbook (fuel and maintenance entries)
   - Checklists (pre-departure and return)
   - Camera integration for maintenance photos
   - Real booking creation with API integration

### Medium-term
3. **Payment Integration**
   - Stripe setup for invoice payments
   - Apple Pay integration in iOS
   - Xero sync for payments

### Long-term
4. **Advanced Features**
   - Xero full integration (invoices, contacts, reports)
   - Push notifications (Firebase)
   - SMS notifications (MessageBird/Twilio)
   - Email notifications (SendGrid)
   - Analytics and reporting dashboard

## Troubleshooting

### iOS App Issues
- Clean build: Cmd+Shift+K in Xcode
- Delete derived data: ~/Library/Developer/Xcode/DerivedData
- Reset simulator: Device > Erase All Content and Settings

### Backend Issues
- Check Docker containers: `docker-compose ps`
- View logs: `docker-compose logs postgres`
- Restart services: `docker-compose restart`

### Database Issues
- Access PostgreSQL: `docker-compose exec postgres psql -U postgres -d yachtlife`
- Run migrations: Backend handles auto-migration on startup

## Code Style Guidelines

### Swift/iOS
- Use SwiftUI for all UI
- Follow MVVM architecture
- Use async/await for networking
- Prefer composition over inheritance
- Use Swift naming conventions

### Go/Backend
- Follow Go standard project layout
- Use GORM for database operations
- Handle errors explicitly
- Write descriptive variable names
- Add comments for complex logic

## External Services

### Current
- PostgreSQL (database)
- MinIO (file storage)

### Planned
- Xero (accounting)
- Stripe (payments)
- Firebase (push notifications)
- SendGrid/SES (email)
- MessageBird/Twilio (SMS)

## Environment Variables

Key variables in `.env`:
```
DB_HOST=localhost
DB_PORT=5432
DB_USER=postgres
DB_PASSWORD=postgres
DB_NAME=yachtlife
JWT_SECRET=your-secret-key
API_PORT=8080
MINIO_ENDPOINT=localhost:9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin
```

## Testing

### Backend
```bash
cd backend
go test ./...
```

### iOS
- Use Xcode's test navigator (Cmd+6)
- Run tests: Cmd+U

## Deployment

### Backend
- Dockerize: `docker build -t yachtlife-api .`
- Deploy to cloud provider (AWS, GCP, DigitalOcean)

### iOS
- Archive in Xcode
- Upload to TestFlight for beta testing
- Submit to App Store

## Resources

- Go Gin Documentation: https://gin-gonic.com/docs/
- SwiftUI Tutorials: https://developer.apple.com/tutorials/swiftui
- GORM Documentation: https://gorm.io/docs/
- Stripe iOS SDK: https://stripe.com/docs/mobile/ios
